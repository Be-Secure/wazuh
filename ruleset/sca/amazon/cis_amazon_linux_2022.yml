# Security Configuration Assessment
# CIS Checks for Amazon Linux 2022
# Copyright (C) 2022, Wazuh Inc.
#
# This program is free software; you can redistribute it
# and/or modify it under the terms of the GNU General Public
# License (version 2) as published by the FSF - Free Software
# Foundation
#
# Based on:
# Center for Internet Security Amazon Linux 2022 Benchmark v1.0.0 - 06-02-2022

policy:
  id: "cis_amazon_linux_2022"
  file: "cis_amazon_linux_2022.yml"
  name: "CIS Benchmark for Amazon Linux 2022"
  description: "This document provides prescriptive guidance for establishing a secure configuration posture for Amazon Linux 2022 systems running on x86 and x64 platforms. This document was tested against Amazon Linux 2022."
  references:
    - https://www.cisecurity.org/cis-benchmarks/

requirements:
  title: "Check Amazon Linux platform."
  description: "Requirements for running the policy against Amazon Linux 2022."
  condition: any
  rules:
    - "f:/etc/system-release -> r:^Amazon && r:release 2022"

variables:
  $sshd_file: /etc/ssh/sshd_config

checks:
  ############################################################
  # 1.1 Filesystem Configuration
  ############################################################

  # 1.1.1.1 Ensure mounting of cramfs filesystems is disabled.
  - id: 31000
    title: "Ensure mounting of cramfs filesystems is disabled."
    description: "The cramfs filesystem type is a compressed read-only Linux filesystem embedded in small footprint systems. A cramfs image can be used without having to first decompress the image."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the server. If this filesystem type is not needed, disable it."
    remediation: "Edit or create the file /etc/modprobe.d/cis.conf and add a line that reads install cramfs /bin/false and a line that reads blacklist cramfs. Run the following command to unload the cramfs module: modprobe -r cramfs"
    compliance:
      - cis: ["1.1.1.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:modprobe -n -v cramfs -> r:install /bin/false|Module cramfs not found"
      - "not c:lsmod -> r:cramfs"
      - 'd:/etc/modprobe.d -> r:\.*.conf -> r:blacklist\scramfs'

  # 1.1.1.2 Ensure mounting of squashfs filesystems is disabled.
  - id: 31001
    title: "Ensure mounting of squashfs filesystems is disabled."
    description: "The squashfs filesystem type is a compressed read-only Linux filesystem embedded in small footprint systems (similar to cramfs). A squashfs image can be used without having to first decompress the image."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    impact: "As Snap packages utilizes squashfs as a compressed filesystem, disabling squashfs will cause Snap packages to fail."
    remediation: "Edit or create the file /etc/modprobe.d/cis.conf and add a line that reads install squashfs /bin/false and a line that reads blacklist squashfs. Run the following command to unload the squashfs module: modprobe -r squashfs"
    compliance:
      - cis: ["1.1.1.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:modprobe -n -v squashfs -> r:install /bin/false|Module squashfs not found"
      - "not c:lsmod -> r:squashfs"
      - 'd:/etc/modprobe.d -> r:\.*.conf -> r:blacklist\ssquashfs'

  # 1.1.1.3 Ensure mounting of udf filesystems is disabled.
  - id: 31002
    title: "Ensure mounting of udf filesystems is disabled."
    description: "The udf filesystem type is the universal disk format used to implement ISO/IEC 13346 and ECMA-167 specifications. This is an open vendor filesystem type for data storage on a broad range of media. This filesystem type is necessary to support writing DVDs and newer optical disc formats."
    rationale: "Removing support for unneeded filesystem types reduces the local attack surface of the system. If this filesystem type is not needed, disable it."
    impact: "Microsoft Azure requires the usage of udf. udf should not be disabled on systems run on Microsoft Azure."
    remediation: "Edit or create the file /etc/modprobe.d/cis.conf and add a line that reads install udf /bin/false and a line that reads blacklist udf. Run the following command to unload the squashfs module: modprobe -r udf"
    compliance:
      - cis: ["1.1.1.3"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:modprobe -n -v udf -> r:install /bin/false|Module udf not found"
      - "not c:lsmod -> r:udf"
      - 'd:/etc/modprobe.d -> r:\.*.conf -> r:blacklist\sudf'

  # 1.1.2.1 Ensure /tmp is a separate partition.
  - id: 31003
    title: "Ensure /tmp is a separate partition."
    description: "The /tmp directory is a world-writable directory used for temporary storage by all users and some applications."
    rationale: "Making /tmp its own file system allows an administrator to set the noexecoption on the mount, making /tmpuseless for an attacker to install executable code. It would also prevent an attacker from establishing a hardlink to a system setuidprogram and wait for it to be updated. Once the program was updated, the hardlink would be broken and the attacker would have his own copy of the program. If the program happened to have a security vulnerability, the attacker could continue to exploit the known flaw. This can be accomplished by either mounting tmpfs to /tmp, or creating a separate partition for /tmp."
    impact: "Since the /tmp directory is intended to be world-writable, there is a risk of resource exhaustion if it is not bound to a separate partition. Running out of /tmp space is a problem regardless of what kind of filesystem lies under it, but in a configuration where /tmp is not a separate file system it will essentially have the whole disk available, as the default installation only creates a single / partition. On the other hand, a RAM-based /tmp (as with tmpfs) will almost certainly be much smaller, which can lead to applications filling up the filesystem much more easily. Another alternative is to create a dedicated partition for /tmp from a separate volume or disk. One of the downsides of a disk-based dedicated partition is that it will be slower than tmpfs which is RAM-based. /tmp utilizing tmpfs can be resized using the size={size} parameter in the relevant entry in /etc/fstab."
    remediation: "First ensure that systemd is correctly configured to ensure that /tmp mount for your environment will be mounted at boot time. # systemctl unmask tmp.mount . For specific configuration requirements of the /tmp mount for your environment, modify /etc/stab. Example using tmpfs with specific mount options: # tmpfs /tmp / tmpfs defaults,rw,nosuid,nodev,noexec,relatime,size=2G 0 0 . Example using a volume or disk with specific mount options, The source location of the volumne or disk will vary depending on your environment: # <device> /tmp <fstype> defaults,nodev,nosuid,noexec 0 0"
    compliance:
      - cis: ["1.1.2.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    references:
      - https://www.freedesktop.org/wiki/Software/systemd/APIFileSystems/
      - https://www.freedesktop.org/software/systemd/man/systemd-fstab-generator.html
    condition: any
    # TODO test
    rules:
      - 'c:findmnt --kernel /tmp -> r:\s/tmp\s'
      - "c:systemctl is-enabled tmp.mount -> r:static|generated"

  # 1.1.2.2 Ensure nodev option set on /tmp partition.
  - id: 31004
    title: "Ensure nodev option set on /tmp partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /tmp filesystem is not intended to support devices, set this option to ensure that users cannot attempt to create block or character special devices in /tmp."
    remediation: "Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /tmp partition: # <device> /tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /tmp with the configured options: # mount -o remount /tmp"
    compliance:
      - cis: ["1.1.2.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /tmp | grep nodev -> r:\s/tmp\s && r:nodev'

  # 1.1.2.3 Ensure noexec option set on /tmp partition.
  - id: 31005
    title: "Ensure noexec option set on /tmp partition."
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Since the /tmp filesystem is only intended for temporary file storage, set this option to ensure that users cannot run executable binaries from /tmp."
    remediation: "Edit the /etc/fstab file and add noexec to the fourth field (mounting options) for the /tmp partition: # <device> /tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /tmp with the configured options: # mount -o remount /tmp"
    compliance:
      - cis: ["1.1.2.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /tmp | grep noexec -> r:\s/tmp\s && r:noexec'
      # - 'c:mount -> r:\s/tmp\s && r:noexec'

  # 1.1.2.4 Ensure nosuid option set on /tmp partition.
  - id: 31006
    title: "Ensure nosuid option set on /tmp partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /tmp filesystem is only intended for temporary file storage, set this option to ensure that users cannot create setuid files in /tmp."
    remediation: "Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /tmp partition: # <device> /tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /tmp with the configured options: # mount -o remount /tmp"
    compliance:
      - cis: ["1.1.2.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /tmp | grep nosuid -> r:\s/tmp\s && r:nosuid'
      # - 'c:mount -> r:\s/tmp\s && r:nosuid'

  # 1.1.3.1 Ensure separate partition exists for /var.
  - id: 31007
    title: "Ensure separate partition exists for /var."
    description: "The /var directory is used by daemons and other system services to temporarily store dynamic data. Some directories created by these processes may be world-writable."
    rationale: "Since the /var directory may contain world-writable files and directories, there is a risk of resource exhaustion if it is not bound to a separate partition."
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing, or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /var. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    compliance:
      - cis: ["1.1.3.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      # TODO test
      - 'c:findmnt --kernel /var -> r:\s/var\s'
      # - 'c:mount -> r:\s/var\s'

  # 1.1.3.2 Ensure nodev option set on /var partition.
  - id: 31008
    title: "Ensure nodev option set on /var partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /var filesystem is not intended to support devices, set this option to ensure that users cannot attempt to create block or character special devices in /var."
    remediation: "Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /var partition: # <device> /var <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /var with the configured options: # mount -o remount /var"
    compliance:
      - cis: ["1.1.3.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /var | grep nodev -> r:\s/var\s && r:nodev'

  # 1.1.3.3 Ensure noexec option set on /var partition.
  - id: 31009
    title: "Ensure noexec option set on /var partition."
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Since the /var filesystem is only intended for variable files such as logs, set this option to ensure that users cannot run executable binaries from /var."
    remediation: "Edit the /etc/fstab file and add noexec to the fourth field (mounting options) for the /var partition: # <device> /var <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /var with the configured options: # mount -o remount /var"
    compliance:
      - cis: ["1.1.3.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /var | grep noexec -> r:\s/var\s && r:noexec'
      # - 'c:mount -> r:\s/var\s && r:noexec'

  # 1.1.3.4 Ensure nosuid option set on /var partition.
  - id: 31010
    title: "Ensure nosuid option set on /var partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /var filesystem is only intended for variable files such as logs, set this option to ensure that users cannot create setuid files in /var."
    remediation: "Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /var partition: # <device> /var <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /var with the configured options: # mount -o remount /var"
    compliance:
      - cis: ["1.1.3.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /var | grep nosuid -> r:\s/var\s && r:nosuid'
      # - 'c:mount -> r:\s/var\s && r:nosuid'

  # 1.1.4.1 Ensure separate partition exists for /var/tmp.
  - id: 31011
    title: "Ensure separate partition exists for /var/tmp."
    description: "The /var/tmp directory is a world-writable directory used for temporary storage by all users and some applications. Temporary file residing in /var/tmp is to be preserved between reboots."
    rationale: "Since the /var/tmp directory is intended to be world-writable, there is a risk of resource exhaustion if it is not bound to a separate partition. In addition, making /var/tmp its own file system allows an administrator to set the noexec option on the mount, making /var/tmp useless for an attacker to install executable code."
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing, or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /var/tmp. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    compliance:
      - cis: ["1.1.4.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      # TODO test
      - 'c:findmnt --kernel /var/tmp -> r:\s/var/tmp\s'
      # - 'c:mount -> r:\s/var\s'

  # 1.1.4.2 Ensure noexec option set on /var/tmp partition.
  - id: 31012
    title: "Ensure noexec option set on /var/tmp partition."
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Since the /var/tmp filesystem is only intended for temporary file storage, set this option to ensure that users cannot run executable binaries from /var/tmp."
    remediation: "Edit the /etc/fstab file and add noexec to the fourth field (mounting options) for the /var/tmp partition: # <device> /var/tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /var/tmp with the configured options: # mount -o remount /var/tmp"
    compliance:
      - cis: ["1.1.4.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /var/tmp | grep noexec -> r:\s/var/tmp\s && r:noexec'
      # - 'c:mount -> r:\s/var/tmp\s && r:noexec'

  # 1.1.4.3 Ensure nosuid option set on /var/tmp partition.
  - id: 31013
    title: "Ensure nosuid option set on /var/tmp partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /var/tmp filesystem is only intended temporary file storage, set this option to ensure that users cannot create setuid files in /var/tmp."
    remediation: "Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /var/tmp partition: # <device> /var/tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /var/tmp with the configured options: # mount -o remount /var/tmp"
    compliance:
      - cis: ["1.1.4.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /var/tmp | grep nosuid -> r:\s/var/tmp\s && r:nosuid'
      # - 'c:mount -> r:\s/var/tmp\s && r:nosuid'

  # 1.1.4.4 Ensure nodev option set on /var/tmp partition.
  - id: 31014
    title: "Ensure nodev option set on /var/tmp partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /var/tmp filesystem is not intended to support devices, set this option to ensure that users cannot attempt to create block or character special devices in /var/tmp."
    remediation: "Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /var/tmp partition: # <device> /var/tmp <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /var/tmp with the configured options: # mount -o remount /var/tmp"
    compliance:
      - cis: ["1.1.4.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /var/tmp | grep nodev -> r:\s/var/tmp\s && r:nodev'

  # 1.1.5.1 Ensure separate partition exists for /var/log.
  - id: 31015
    title: "Ensure separate partition exists for /var/log."
    description: "The /var/log directory is used by system services to store log data."
    rationale: "There are two important reasons to ensure that system logs are stored on a separate partition: protection against resource exhaustion (since logs can grow quite large) and protection of audit data."
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing, or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /var/log. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    compliance:
      - cis: ["1.1.5.1"]
      - cis_csc_v8: ["8.3"]
      - cis_csc_v7: ["6.4"]
      - pci_dss_3.2.1: ["10.7"]
      - soc_2: ["A1.1"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      # TODO test
      - 'c:findmnt --kernel /var/log -> r:\s/var/log\s'
      # - 'c:mount -> r:\s/var\s'

  # 1.1.5.2 Ensure nodev option set on /var/log partition.
  - id: 31016
    title: "Ensure nodev option set on /var/log partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /var/log filesystem is not intended to support devices, set this option to ensure that users cannot attempt to create block or character special devices in /var/log."
    remediation: "Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /var/log partition: # <device> /var/log <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /var/log with the configured options: # mount -o remount /var/log"
    compliance:
      - cis: ["1.1.5.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /var/log | grep nodev -> r:\s/var/log\s && r:nodev'

  # 1.1.5.3 Ensure noexec option set on /var/log partition.
  - id: 31017
    title: "Ensure noexec option set on /var/log partition."
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Since the /var/log filesystem is only intended for temporary file storage, set this option to ensure that users cannot run executable binaries from /var/log."
    remediation: "Edit the /etc/fstab file and add noexec to the fourth field (mounting options) for the /var/log partition: # <device> /var/log <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /var/log with the configured options: # mount -o remount /var/log"
    compliance:
      - cis: ["1.1.5.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /var/log | grep noexec -> r:\s/var/log\s && r:noexec'
      # - 'c:mount -> r:\s/var/log\s && r:noexec'

  # 1.1.5.4 Ensure nosuid option set on /var/log partition.
  - id: 31018
    title: "Ensure nosuid option set on /var/log partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /var/log filesystem is only intended temporary file storage, set this option to ensure that users cannot create setuid files in /var/log."
    remediation: "Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /var/log partition: # <device> /var/log <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /var/log with the configured options: # mount -o remount /var/log"
    compliance:
      - cis: ["1.1.5.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /var/log | grep nosuid -> r:\s/var/log\s && r:nosuid'
      # - 'c:mount -> r:\s/var/log\s && r:nosuid'

  # 1.1.6.1 Ensure separate partition exists for /var/log/audit.
  - id: 31019
    title: "Ensure separate partition exists for /var/log/audit."
    description: "The auditing daemon, auditd, stores log data in the /var/log/audit directory."
    rationale: "There are two important reasons to ensure that data gathered by auditd is stored on a separate partition: protection against resource exhaustion (since the audit.log file can grow quite large) and protection of audit data."
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing, or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /var/log/audit. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    compliance:
      - cis: ["1.1.6.1"]
      - cis_csc_v8: ["8.3"]
      - cis_csc_v7: ["6.4"]
      - pci_dss_3.2.1: ["10.7"]
      - soc_2: ["A1.1"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      # TODO test
      - 'c:findmnt --kernel /var/log/audit -> r:\s/var/log/audit\s'
      # - 'c:mount -> r:\s/var\s'

  # 1.1.6.2 Ensure noexec option set on /var/log/audit partition.
  - id: 31020
    title: "Ensure noexec option set on /var/log/audit partition."
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Since the /var/log/audit filesystem is only intended for temporary file storage, set this option to ensure that users cannot run executable binaries from /var/log/audit."
    remediation: "Edit the /etc/fstab file and add noexec to the fourth field (mounting options) for the /var/log/audit partition: # <device> /var/log/audit <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /var/log/audit with the configured options: # mount -o remount /var/log/audit"
    compliance:
      - cis: ["1.1.6.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /var/log/audit | grep noexec -> r:\s/var/log/audit\s && r:noexec'
      # - 'c:mount -> r:\s/var/log/audit\s && r:noexec'

  # 1.1.6.3 Ensure nodev option set on /var/log/audit partition.
  - id: 31021
    title: "Ensure nodev option set on /var/log/audit partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /var/log/audit filesystem is not intended to support devices, set this option to ensure that users cannot attempt to create block or character special devices in /var/log/audit."
    remediation: "Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /var/log/audit partition: # <device> /var/log/audit <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /var/log/audit with the configured options: # mount -o remount /var/log/audit"
    compliance:
      - cis: ["1.1.6.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /var/log/audit | grep nodev -> r:\s/var/log/audit\s && r:nodev'

  # 1.1.6.4 Ensure nosuid option set on /var/log/audit partition.
  - id: 31022
    title: "Ensure nosuid option set on /var/log/audit partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /var/log/audit filesystem is only intended temporary file storage, set this option to ensure that users cannot create setuid files in /var/log/audit."
    remediation: "Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /var/log/audit partition: # <device> /var/log/audit <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /var/log/audit with the configured options: # mount -o remount /var/log/audit"
    compliance:
      - cis: ["1.1.6.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /var/log/audit | grep nosuid -> r:\s/var/log/audit\s && r:nosuid'
      # - 'c:mount -> r:\s/var/log/audit\s && r:nosuid'

  # 1.1.7.1 Ensure separate partition exists for /home.
  - id: 31023
    title: "Ensure separate partition exists for /home."
    description: "The /home directory is used to support disk storage needs of local users."
    rationale: "If the system is intended to support local users, create a separate partition for the /home directory to protect against resource exhaustion and restrict the type of files that can be stored under /home."
    impact: "Resizing filesystems is a common activity in cloud-hosted servers. Separate filesystem partitions may prevent successful resizing, or may require the installation of additional tools solely for the purpose of resizing operations. The use of these additional tools may introduce their own security considerations."
    remediation: "For new installations, during installation create a custom partition setup and specify a separate partition for /home. For systems that were previously installed, create a new partition and configure /etc/fstab as appropriate."
    compliance:
      - cis: ["1.1.7.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - AJ Lewis, "LVM HOWTO", https://tldp.org/HOWTO/LVM-HOWTO/
    condition: all
    rules:
      # TODO test
      - 'c:findmnt --kernel /home -> r:\s/home\s'
      # - 'c:mount -> r:\s/var\s'

  # 1.1.7.2 Ensure nodev option set on /home partition.
  - id: 31024
    title: "Ensure nodev option set on /home partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices."
    rationale: "Since the /home filesystem is not intended to support devices, set this option to ensure that users cannot attempt to create block or character special devices in /home."
    remediation: "Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /home partition: # <device> /home <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /home with the configured options: # mount -o remount /home"
    compliance:
      - cis: ["1.1.6.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /home | grep nodev -> r:\s/home\s && r:nodev'

  # 1.1.7.3 Ensure nosuid option set on /home partition.
  - id: 31025
    title: "Ensure nosuid option set on /home partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Since the /home filesystem is only intended temporary file storage, set this option to ensure that users cannot create setuid files in /home."
    remediation: "Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /home partition: # <device> /home <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /home with the configured options: # mount -o remount /home"
    compliance:
      - cis: ["1.1.7.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /home | grep nosuid -> r:\s/home\s && r:nosuid'
      # - 'c:mount -> r:\s/home\s && r:nosuid'

  # 1.1.7.4 Ensure usrquota option set on /home partition.
  - id: 31026
    title: "Ensure usrquota option set on /home partition."
    description: "The usrquota mount option allows for the filesystem to have disk quotas configured."
    rationale: "To ensure the availability of disk space on /home, it is important to limit the impact a single user or group can cause for other users (or the wider system) by accidentally filling up the partition. Quotas can also be applied to inodes for filesystems where inode exhaustion is a concern."
    remediation: "Edit the /etc/fstab file and add usrquota to the fourth field (mounting options) for the /home partition: # <device> /home <fstype> defaults,rw,usrquota,grpquota,nodev,relatime 0 0 . Run the following command to remount /home with the configured options: # mount -o remount /home . Create the quota database with # quotacheck -cugv /home , then, restore SELinux context on the quota database file with # restorecon /home/aquota.user and finally enable quotas on the partition with # quotaon -vug /home"
    compliance:
      - cis: ["1.1.7.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) and edquota(8) manual pages for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /home | grep usrquota -> r:\s/home\s && r:usrquota'
      # - 'c:mount -> r:\s/home\s && r:usrquota'

  # 1.1.7.5 Ensure grpquota option set on /home partition.
  - id: 31027
    title: "Ensure grpquota option set on /home partition."
    description: "The grpquota mount option allows for the filesystem to have disk quotas configured."
    rationale: "To ensure the availability of disk space on /home, it is important to limit the impact a single user or group can cause for other users (or the wider system) by accidentally filling up the partition. Quotas can also be applied to inodes for filesystems where inode exhaustion is a concern."
    remediation: "Edit the /etc/fstab file and add grpquota to the fourth field (mounting options) for the /home partition: # <device> /home <fstype> defaults,rw,grpquota,grpquota,nodev,relatime 0 0 . Run the following command to remount /home with the configured options: # mount -o remount /home . Create the quota database with # quotacheck -cugv /home , then, restore SELinux context on the quota database file with # restorecon /home/aquota.group and finally enable quotas on the partition with # quotaon -vug /home"
    compliance:
      - cis: ["1.1.7.5"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) and edquota(8) manual pages for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /home | grep grpquota -> r:\s/home\s && r:grpquota'
      # - 'c:mount -> r:\s/home\s && r:grpquota'

  # 1.1.8.1 Ensure nodev option set on /dev/shm partition.
  - id: 31028
    title: "Ensure nodev option set on /dev/shm partition."
    description: "The nodev mount option specifies that the filesystem cannot contain special devices partitions."
    rationale: "Since the /dev/shm filesystem is not intended to support devices, set this option to ensure that users cannot attempt to create block or character special devices in /dev/shm."
    remediation: "Edit the /etc/fstab file and add nodev to the fourth field (mounting options) for the /dev/shm partition: # <device> /dev/shm <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /dev/shm with the configured options: # mount -o remount /dev/shm"
    compliance:
      - cis: ["1.1.8.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:mount -> r:\s/dev/shm\s && r:nodev'

  # 1.1.8.2 Ensure noexec option set on /dev/shm partition.
  - id: 31029
    title: "Ensure noexec option set on /dev/shm partition."
    description: "The noexec mount option specifies that the filesystem cannot contain executable binaries."
    rationale: "Setting this option on a file system prevents users from executing programs from shared memory. This deters users from introducing potentially malicious software on the system."
    remediation: "Edit the /etc/fstab file and add noexec to the fourth field (mounting options) for the /dev/shm partition: # <device> /dev/shm <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /dev/shm with the configured options: # mount -o remount /dev/shm"
    compliance:
      - cis: ["1.1.8.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /dev/shm | grep noexec -> r:\s/dev/shm\s && r:noexec'
      # - 'c:mount -> r:\s/dev/shm\s && r:noexec'

  # 1.1.8.3 Ensure nosuid option set on /dev/shm partition.
  - id: 31030
    title: "Ensure nosuid option set on /dev/shm partition."
    description: "The nosuid mount option specifies that the filesystem cannot contain setuid files."
    rationale: "Setting this option on a file system prevents users from introducing privileged programs onto the system and allowing non-root users to execute them."
    remediation: "Edit the /etc/fstab file and add nosuid to the fourth field (mounting options) for the /dev/shm partition: # <device> /dev/shm <fstype> defaults,rw,nosuid,nodev,noexec,relatime 0 0 . Run the following command to remount /dev/shm with the configured options: # mount -o remount /dev/shm"
    compliance:
      - cis: ["1.1.8.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: all
    # TODO test
    rules:
      - 'c:findmnt --kernel /dev/shm | grep nosuid -> r:\s/dev/shm\s && r:nosuid'
      # - 'c:mount -> r:\s/dev/shm\s && r:nosuid'

  # 1.1.9 Disable Automounting.
  - id: 31031
    title: "Disable Automounting."
    description: "autofs allows automatic mounting of devices, typically including CD/DVDs and USB drives."
    rationale: "With automounting enabled anyone with physical access could attach a USB drive or disc and have its contents available in system even if they lacked permissions to mount it themselves."
    impact: "The use of portable hard drives is very common for workstation users. If your organization allows the use of portable storage or media on workstations and physical access controls to workstations is considered adequate there is little value add in turning off automounting."
    remediation: "Run the following command to disable autofs: systemctl --now disable autofs . If there are no other packages that depends on autofs, remove the package with: # dnf remove autofs"
    compliance:
      - cis: ["1.1.9"]
      - cis_csc_v8: ["10.3"]
      - cis_csc_v7: ["8.5"]
      - nist_sp_800-53: ["SC-18(4)"]
      - cmmc_v2.0: ["MP.L2-3.8.7"]
      - hipaa: ["164.310(d)(1)"]
    condition: none
    rules:
      - "c:systemctl is-enabled autofs -> r:Failed|disabled"

  # 1.1.10  Disable USB Storage.
  - id: 31032
    title: "Disable USB Storage."
    description: "USB storage provides a means to transfer and store files insuring persistence and availability of the files independent of network connection status. Its popularity and utility has led to USB-based malware being a simple and common means for network infiltration and a first step to establishing a persistent threat within a networked environment."
    rationale: "Restricting USB access on the system will decrease the physical attack surface for a device and diminish the possible vectors to introduce malware."
    remediation: "Edit or create a file in the /etc/modprobe.d/ directory ending in .conf Example: vim /etc/modprobe.d/usb_storage.conf . Add the following line: install usb-storage /bin/true . Run the following command to unload the usb-storage module: rmmod usb-storage"
    compliance:
      - cis: ["1.1.10"]
      - cis_csc_v8: ["10.3"]
      - cis_csc_v7: ["13.7"]
      - nist_sp_800-53: ["SC-18(4)"]
      - cmmc_v2.0: ["MP.L2-3.8.7"]
      - hipaa: ["164.310(d)(1)"]
    condition: all
    rules:
      - "c:modprobe -n -v usb-storage -> r:install /bin/true"
      - "not c:lsmod -> r:usb-storage"

  ############################################################
  # 1.2 Configure Software Updates.
  ############################################################

  # 1.2.1 Ensure GPG keys are configured -> can't be implemented - requires manual action.

  # 1.2.2 Ensure gpgcheck is globally activated
  - id: 31033
    title: "Ensure gpgcheck is globally activated."
    description: "The gpgcheck option, found in the main section of the /etc/dnf/dnf.conf and individual /etc/yum/repos.d/* files determines if an RPM package's signature is checked prior to its installation."
    rationale: "It is important to ensure that an RPM's package signature is always checked prior to installation to ensure that the software is obtained from a trusted source."
    remediation: "Edit /etc/dnf/dnf.conf and set ' gpgcheck=1 ' in the [main] section. Edit any failing files in /etc/yum.repos.d/* and set all instances of gpgcheck to ' 1 '."
    compliance:
      - cis: ["1.2.2"]
      - cis_csc_v8: ["7.3"]
      - cis_csc_v7: ["3.4"]
      - nist_sp_800-53: ["SI-2"]
      - cmmc_v2.0: ["SI.L1-3.14.1"]
      - pci_dss_3.2.1: ["6.2"]
      - soc_2: ["CC7.1"]
    condition: all
    rules:
      - "f:/etc/dnf/dnf.conf -> r:gpgcheck=1"
      - "not c:grep -Rh ^gpgcheck /etc/yum.repos.d/ -> r:gpgcheck=0"

  # 1.2.3 Ensure package manager repositories are configured -> can't be implemented - requires manual action.

  ############################################################
  # 1.3 Filesystem Integrity Checking.
  ############################################################

  # 1.3.1 Ensure AIDE is installed.
  - id: 31034
    title: "Ensure AIDE is installed."
    description: "AIDE takes a snapshot of filesystem state including modification times, permissions, and file hashes which can then be used to compare against the current state of the filesystem to detect modifications to the system."
    rationale: "By monitoring the filesystem state compromised files can be detected to prevent or limit the exposure of accidental or malicious misconfigurations or modified binaries."
    remediation: "Run the following command to install AIDE: # rpm -q aide . Configure AIDE as appropriate for your environment. Consult the AIDE documentation for options. Initialize AIDE: # aide --init && mv /var/lib/aide/aide.db.new.gz /var/lib/aide/aide.db.gz"
    compliance:
      - cis: ["1.3.1"]
      - cis_csc_v8: ["3.14"]
      - cis_csc_v7: ["14.9"]
      - nist_sp_800-53: ["AU-2"]
      - cmmc_v2.0: ["AC.L2-3.1.7"]
      - hipaa: ["164.312(b)", "164.312(c)(1)", "164.312(c)(2)"]
      - pci_dss_3.2.1: ["10.2.1", "11.5"]
      - pci_dss_4.0: ["10.2.1", "10.2.1.1"]
      - soc_2: ["CC6.1"]
    references:
      - "AIDE stable manual: http://aide.sourceforge.net/stable/manual.html"
    condition: all
    rules:
      - "c:rpm -q aide -> r:aide-"

  # 1.3.2 Ensure filesystem integrity is regularly checked.
  - id: 31035
    title: "Ensure filesystem integrity is regularly checked."
    description: "Periodic checking of the filesystem integrity is needed to detect changes to the filesystem."
    rationale: "Periodic file checking allows the system administrator to determine on a regular basis if critical files have been changed in an unauthorized fashion."
    remediation: "If cron will be used to schedule and run aide check run the following command: crontab -u root -e         Add the following line to the crontab: 0 5 * * * /usr/sbin/aide --check  // Notes: The checking in this recommendation occurs every day at 5am. Alter the frequency and time of the checks in compliance with site policy.              OR        If aidecheck.service and aidecheck.timer will be used to schedule and run aide check: Create or edit the file /etc/systemd/system/aidecheck.service and add the following lines:    [Unit]      Description=Aide Check    [Service]     Type=simpleExecStart=/usr/sbin/aide --check      [Install]     WantedBy=multi-user.target      Create or edit the file  /etc/systemd/system/aidecheck.timer and add the following lines:   [Unit]   Description=Aide check every day at 5AM      [Timer]     OnCalendar=*-*-* 05:00:00      Unit=aidecheck.service      [Install]     WantedBy=multi-user.target        Run the following commands:        # chown root:root /etc/systemd/system/aidecheck.*         # chmod 0644 /etc/systemd/system/aidecheck.*           # systemctl daemon-reload          # systemctl enable aidecheck.service        # systemctl --now enable aidecheck.timer "
    compliance:
      - cis: ["1.3.2"]
      - cis_csc_v8: ["3.14"]
      - cis_csc_v7: ["14.9"]
      - nist_sp_800-53: ["AU-2"]
      - cmmc_v2.0: ["AC.L2-3.1.7"]
      - hipaa: ["164.312(b)", "164.312(c)(1)", "164.312(c)(2)"]
      - pci_dss_3.2.1: ["10.2.1", "11.5"]
      - pci_dss_4.0: ["10.2.1", "10.2.1.1"]
      - soc_2: ["CC6.1"]
    references:
      - https://github.com/konstruktoid/hardening/blob/master/config/aidecheck.service
      - https://github.com/konstruktoid/hardening/blob/master/config/aidecheck.timer
    condition: any
    rules:
      - "c:crontab -u root -l -> r:aide"
      - "c:grep -r aide /etc/cron.* /etc/crontab -> r:aide"
      - "c:systemctl is-enabled aidecheck.service -> r:enabled"
      - "c:systemctl is-enabled aidecheck.timer -> r:enabled"
      - "c:systemctl status aidecheck.timer -> r:enabled"

  ############################################################
  # 1.4 Secure Boot Settings.
  ############################################################

  # 1.4.1 Ensure bootloader password is set
  - id: 31036
    title: "Ensure bootloader password is set."
    description: "Setting the boot loader password will require that anyone rebooting the system must enter a password before being able to set command line boot parameters."
    rationale: "Requiring a boot password upon execution of the boot loader will prevent an unauthorized user from entering boot parameters or changing the boot partition. This prevents users from weakening security (e.g. turning off SELinux at boot time)."
    impact: 'If password protection is enabled, only the designated superuser can edit a Grub 2 menu item by pressing "e" or access the GRUB 2 command line by pressing "c". If GRUB 2 is set up to boot automatically to a password-protected menu entry the user has no option to back out of the password prompt to select another menu entry. Holding the SHIFT key will not display the menu in this case. The user must enter the correct username and password. If unable, the configuration files will have to be edited via the LiveCD or other means to fix the problem You can add --unrestricted to the menu entries to allow the system to boot without entering a password. Password will still be required to edit menu items.'
    remediation: "Create an encrypted password with grub2-setpassword and the run the following commnad to update the grub2 configuration: # grub2-mkconfig -o /boot/grub2/grub.cfg"
    compliance:
      - cis: ["1.4.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - soc_2: ["CC5.2", "CC6.1"]
    references:
      - See the fstab(5) manual page for more information.
    condition: any
    # TODO test
    rules:
      - 'f:/boot/grub2/user.cfg -> r:^\h*GRUB2_PASSWORD\h*=\h*.+$'
      - 'f:/boot/grub2/grub.cfg -> r:^\h*set\h+superusers\h*=\h*"?[^"\n\r]+"?(\h+.*)?$'
      - 'f:/boot/grub2/grub.cfg -> r:^\h*password(_pbkdf2)?\h+\H+\h+.+$'

  # 1.4.2 Ensure permissions on bootloader config are configured.
  - id: 31037
    title: "Ensure permissions on bootloader config are configured."
    description: "The grub configuration file contains information on boot settings and passwords for unlocking boot options. The grub configuration is usually located at /boot/grub2/grub.cfg and linked as /etc/grub2.cfg .  On newer grub2 systems the encrypted bootloader password is contained in /boot/grub2/user.cfg ."
    rationale: "Setting the permissions to read and write for root only prevents non-root users from seeing the boot parameters or changing them. Non-root users who read the boot parameters may be able to identify weaknesses in security upon boot and be able to exploit them."
    remediation: "Run the following commands to set permissions on your grub configuration: # chown root:root /boot/grub2/grub.cfg    # chmod og-rwx /boot/grub2/grub.cfg # chown root:root /boot/grub2/grubenv    # chmod og-rwx /boot/grub2/grubenv  # chown root:root /boot/grub2/user.cfg  # chmod og-rwx /boot/grub2/user.cfg     OR if the stystem uses UEFI, edit /etc/fstab and add the fmask=0077, uid=0 and gid=0 options. Example: <device> /boot/efi vfat defaults,umask=0027,fmask=0077,uid=0,gid=0 0 0 "
    compliance:
      - cis: ["1.4.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - nist_sp_800-53: ["AC-5", "AC-6"]
      - soc_2: ["CC5.2", "CC6.1"]
    condition: all
    rules:
      - 'c:stat -L /boot/grub2/grub.cfg -> r:Access:\s*\(0\d00/-\w\w\w------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'
      - 'c:stat -L /boot/grub2/grubenv -> r:Access:\s*\(0\d00/-\w\w\w------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'
      - 'c:stat -L /boot/grub2/user.cfg -> r:Access:\s*\(0\d00/-\w\w\w------\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)|cannot stat'

  # 1.4.3 Ensure authentication required when booting into rescue mode.
  - id: 31038
    title: "Ensure authentication required when booting into rescue mode."
    description: "Rescue mode (former single user mode) is used for recovery when the system detects an issue during boot or by manual selection from the bootloader."
    rationale: "Requiring authentication in rescue mode (former single user mode) prevents an unauthorized user from rebooting the system into rescue mode to gain root privileges without credentials."
    remediation: "The systemd drop-in files must be created if it is necessary to change the default settings: create the file /etc/systemd/system/rescue.service.d/00-require-auth.conf which contains only the configuration to be overriden: # [Service]  ExecStart=-/usr/lib/systemd/systemd-sulogin-shell rescue"
    compliance:
      - cis: ["1.4.3"]
      - cis_csc_v8: ["5.2"]
      - cis_csc_v7: ["4.4"]
      - cmmc_v2.0: ["IA.L2-3.5.7"]
      - pci_dss_4.0: ["2.2.2", "8.3.5", "8.3.6", "8.6.3"]
      - soc_2: ["CC6.1"]
    condition: all
    rules:
      - 'f:/usr/lib/systemd/system/rescue.service -> r:ExecStart=-/bin/sh -c "/sbin/sulogin; /usr/bin/systemctl --fail --no-block default"|ExecStart=-/bin/sh -c "/usr/sbin/sulogin; /usr/bin/systemctl --fail --no-block default"'
      - 'f:/usr/lib/systemd/system/emergency.service -> r:ExecStart=-/bin/sh -c "/sbin/sulogin; /usr/bin/systemctl --fail --no-block default"|ExecStart=-/bin/sh -c "/usr/sbin/sulogin; /usr/bin/systemctl --fail --no-block default"'

  ############################################################
  # 1.5 Additional Process Hardening.
  ############################################################
  # 1.5.1 Ensure core dump storage is disabled.
  - id: 31039
    title: "Ensure core dump storage is disabled."
    description: "A core dump is the memory of an executable program. It is generally used to determine why a program aborted. It can also be used to glean confidential information from a core file."
    rationale: "A core dump includes a memory image taken at the time the operating system terminates an application. The memory image could contain sensitive data and is generally useful only for developers trying to debug problems."
    remediation: "Edit /etc/systemd/coredump.conf and edit or add the following line: Storage=none"
    compliance:
      - cis: ["1.5.1"]
      - cis_csc: ["5.1"]
      - pci_dss: ["2.2.4"]
      - nist_sp_800-53: ["CM.1"]
      - tsc: ["CC5.2"]
    references:
      - https://www.freedesktop.org/software/systemd/man/coredump.conf.html
    condition: all
    rules:
      - "f: /etc/systemd/coredump.conf -> r:Storage=none"
      # ^\s*storage\s*=\s*none

    # 1.5.2 Ensure core dump backtraces are disabled.
  - id: 31040
    title: "Ensure core dump backtraces are disabled."
    description: "A core dump is the memory of an executable program. It is generally used to determine why a program aborted. It can also be used to glean confidential information from a core file."
    rationale: "A core dump includes a memory image taken at the time the operating system terminates an application. The memory image could contain sensitive data and is generally useful only for developers trying to debug problems, increasing the risk to the system."
    remediation: "Edit /etc/systemd/coredump.conf and edit or add the following line: ProcessSizeMax=0"
    compliance:
      - cis: ["1.5.2"]
      - nist_sp_800-53: ["CM-6b"]
    references:
      - https://www.freedesktop.org/software/systemd/man/coredump.conf.html
    condition: all
    rules:
      - "f: /etc/systemd/coredump.conf -> r:ProcessSizeMax=0"
      # ^\s*ProcessSizeMax\s*=\s*0

  # 1.5.3 Ensure address space layout randomization (ASLR) is enabled.
  - id: 31041
    title: "Ensure address space layout randomization (ASLR) is enabled."
    description: "Address space layout randomization (ASLR) is an exploit mitigation technique which randomly arranges the address space of key data areas of a process."
    rationale: "Randomly placing virtual memory regions will make it difficult to write memory page exploits as the memory placement will be consistently shifting."
    remediation: "Set the following parameter in /etc/sysctl.conf or a /etc/sysctl.d/* file: kernel.randomize_va_space = 2. Run the following command to set the active kernel parameter: # sysctl -w kernel.randomize_va_space=2"
    compliance:
      - cis: ["1.5.3"]
      - cis_csc_v8: ["10.5"]
      - cis_csc_v7: ["8.3"]
      - pci_dss_3.2.1: ["1.4"]
      - nist_sp_800-53: ["SI-16"]
      - soc_2: ["CC6.8"]

      - cis_csc: ["8.3"]
      - pci_dss: ["2.2.4"]
      - nist_800-53: ["CM.1", "CM-6b"]
      - tsc: ["CC5.2"]
    condition: all
    rules:
      - 'c:grep -Rh ^kernel\.randomize_va_space /etc/sysctl.conf /etc/sysctl.d -> r:^\s*kernel.randomize_va_space\s*=\s*2$'
      - 'c:sysctl kernel.randomize_va_space -> r:^\s*kernel.randomize_va_space\s*=\s*2'

  ############################################################
  # 1.6 Mandatory Access Control.
  ############################################################
  # 1.6.1 Configure SELinux.
  ############################################################

  # 1.6.1.1 Ensure SELinux is installed.
  - id: 31042
    title: "Ensure SELinux is installed."
    description: "SELinux provides Mandatory Access Controls."
    rationale: "Without a Mandatory Access Control system installed only the default Discretionary Access Control system will be available."
    remediation: "Run the following command to install libselinux: # dnf install libselinux"
    compliance:
      - cis: ["1.6.1.1"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
    condition: all
    rules:
      - 'c:rpm -q libselinux -> r:libselinux-\S+'

  # 1.6.1.2 Ensure SELinux is not disabled in bootloader configuration.
  - id: 31043
    title: "Ensure SELinux is not disabled in bootloader configuration."
    description: "Configure SELINUX to be enabled at boot time and verify that it has not been overwritten by the grub boot parameters."
    rationale: "SELinux must be enabled at boot time in your grub configuration to ensure that the controls it provides are not overridden."
    IMPACT: "Files created while SELinux is disabled are not labeled at all. This behavior causes problems when changing to enforcing mode because files are labeled incorrectly or are not labeled at all. To prevent incorrectly labeled and unlabeled files from causing problems, file systems are automatically relabeled when changing from the disabled state to permissive or enforcing mode. This can be a long running process that should be accounted for as it may extend downtime during initial re-boot."
    remediation: 'Run the following command to remove all instances of selinux=0 and enforcing=0 from all CMDLINE_LINUX parameters: grubby --update-kernel ALL --remove-args "selinux=0 enforcing=0"'
    compliance:
      - cis: ["1.6.1.2"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
    condition: none
    rules:
      - 'f:/boot/grub2/grub.cfg -> r:^\s*linux\.+selinux=0|linux\.+enforcing=0'
      - 'f:/boot/grub2/grubenv -> r:^\s*linux\.+selinux=0|linux\.+enforcing=0'
      - 'f:/boot/grub2/grub.conf -> r:^\s*linux\.+selinux=0|linux\.+enforcing=0'

  # 1.6.1.3 Ensure SELinux policy is configured.
  - id: 31044
    title: "Ensure SELinux policy is configured."
    description: "Configure SELinux to meet or exceed the default targeted policy, which constrains daemons and system software only."
    rationale: "Security configuration requirements vary from site to site. Some sites may mandate a policy that is stricter than the default policy, which is perfectly acceptable. This item is intended to ensure that at least the default recommendations are met."
    remediation: "Edit the /etc/selinux/config file to set the SELINUXTYPE parameter: SELINUXTYPE=targeted"
    compliance:
      - cis: ["1.6.1.3"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
    condition: all
    rules:
      - 'c:sestatus -> r:^Loaded policy name:\s*\t*targeted$|^Loaded policy name:\s*\t*mls'
      - 'f:/etc/selinux/config -> r:^\s*SELINUXTYPE\s*=\s*targeted|^\s*SELINUXTYPE\s*=\s*mls'

    # 1.6.1.4 Ensure the SELinux mode is not disabled.
  - id: 31045
    title: "Ensure the SELinux mode is not disabled."
    description: "SELinux can run in one of three modes: disabled, permissive, or enforcing: Enforcing - Is the default, and recommended, mode of operation; in enforcing mode SELinux operates normally, enforcing the loaded security policy on the entire system. Permissive - The system acts as if SELinux is enforcing the loaded security policy, including labeling objects and emitting access denial entries in the logs, but it does not actually deny any operations. While not recommended for production systems, permissive mode can be helpful for SELinux policy development. Disabled - Is strongly discouraged; not only does the system avoid enforcing the SELinux policy, it also avoids labeling any persistent objects such as files, making it difficult to enable SELinux in the future Note: you can set individual domains to permissive mode while the system runs in enforcing mode. For example, to make the httpd_t domain permissive: # semanage permissive -a httpd_t."
    rationale: "Running SELinux in disabled mode is strongly discouraged; not only does the system avoid enforcing the SELinux policy, it also avoids labeling any persistent objects such as files, making it difficult to enable SELinux in the future."
    remediation: "Run one of the following commands to set SELinux's running mode: To set SELinux mode to Enforcing: # setenforce 1    OR     To set SELinux mode to Permissive: # setenforce 0     Edit the /etc/selinux/config file to set the SELINUX parameter: For Enforcing mode: SELINUX=enforcing   OR    For Permissive mode:  SELINUX=permissive"
    compliance:
      - cis: ["1.6.1.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
    references:
      - https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/selinux_users_and_administrators_guide/sect-security-enhanced_linux-introduction-selinux_modes
    condition: all
    rules:
      - "c:getenforce -> r:Enforcing|Permisive"
      - "f:/etc/selinux/config -> r:^SELINUX=enforcing|^SELINUX=Permisive"

  # 1.6.1.5 Ensure the SELinux mode is enforcing.
  - id: 31046
    title: "Ensure the SELinux mode is enforcing."
    description: "Set SELinux to enable when the system is booted."
    rationale: "SELinux must be enabled at boot time in to ensure that the controls it provides are in effect at all times."
    remediation: "Edit the /etc/selinux/config file to set the SELINUX parameter: SELINUX=enforcing  . Run the following command to set SELinux's running mode: # setenforce 1"
    compliance:
      - cis: ["1.6.1.5"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
    references:
      - https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/selinux_users_and_administrators_guide/sect-security-enhanced_linux-introduction-selinux_modes
    condition: all
    rules:
      - "c:getenforce -> r:Enforcing"
      - "f:/etc/selinux/config -> r:^SELINUX=enforcing"

  # 1.6.1.6 Ensure no unconfined services exist.
  - id: 31047
    title: "Ensure no unconfined services exist."
    description: "Unconfined processes run in unconfined domains."
    rationale: "For unconfined processes, SELinux policy rules are applied, but policy rules exist that allow processes running in unconfined domains almost all access. Processes running in unconfined domains fall back to using DAC rules exclusively. If an unconfined process is compromised, SELinux does not prevent an attacker from gaining access to system resources and data, but of course, DAC rules are still used. SELinux is a security enhancement on top of DAC rules - it does not replace them."
    remediation: "Investigate any unconfined processes found during the audit action. They may need to have an existing security context assigned to them or a policy built for them. Occasionally certain daemons such as backup or centralized management software may require running unconfined. Any such software should be carefully analyzed and documented before such an exception is made."
    compliance:
      - cis: ["1.6.1.6"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
    references:
      - https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/selinux_users_and_administrators_guide/sect-security-enhanced_linux-introduction-selinux_modes
    condition: all
    rules:
      - "c:ps -eZ | grep unconfined_service_t -> !r:\\."

  # 1.6.1.7 Ensure SETroubleshoot is not installed.
  - id: 31048
    title: "Ensure SETroubleshoot is not installed."
    description: "The SETroubleshoot service notifies desktop users of SELinux denials through a user-friendly interface. The service provides important information around configuration errors, unauthorized intrusions, and other potential errors."
    rationale: "The SETroubleshoot service is an unnecessary daemon to have running on a server, especially if X Windows is disabled."
    remediation: "Run the following command to uninstall setroubleshoot: # dnf remove setroubleshoot"
    compliance:
      - cis: ["1.6.1.7"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
    references:
      - https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/selinux_users_and_administrators_guide/sect-security-enhanced_linux-introduction-selinux_modes
    condition: all
    rules:
      - "c:rpm -q setroubleshoot -> r:package setroubleshoot is not installed"

  # 1.6.1.8 Ensure the MCS Translation Service (mcstrans) is not installed.
  - id: 31049
    title: "Ensure the MCS Translation Service (mcstrans) is not installed."
    description: "The mcstransd daemon provides category label information to client processes requesting information. The label translations are defined in /etc/selinux/targeted/setrans.conf."
    rationale: "Since this service is not used very often, remove it to reduce the amount of potentially vulnerable code running on the system."
    remediation: "Run the following command to uninstall mcstrans: # dnf remove mcstrans"
    compliance:
      - cis: ["1.6.1.8"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
    condition: all
    rules:
      - "c:rpm -q mcstrans -> r:package mcstrans is not installed"

  ############################################################
  # 1.7  Warning Banners.
  ############################################################
  # 1.7.1 Ensure message of the day is configured properly.
  - id: 31050
    title: "Ensure message of the day is configured properly."
    description: "The contents of the /etc/motd file are displayed to users after login and function as a message of the day for authenticated users. Unix-based systems have typically displayed information about the OS release and patch level upon logging in to the system. This information can be useful to developers who are developing software for a particular OS platform. If mingetty(8) supports the following options, they display operating system information: \\m - machine architecture \\r - operating system release \\s - operating system name \\v - operating system version."
    rationale: 'Warning messages inform users who are attempting to login to the system of their legal status regarding the system and must include the name of the organization that owns the system and any monitoring policies that are in place. Displaying OS and patch level information in login banners also has the side effect of providing detailed system information to attackers attempting to target specific exploits of a system. Authorized users can easily get this information by running the " uname -a " command once they have logged in.'
    remediation: "Edit the /etc/motd file with the appropriate contents according to your site policy, remove any instances of \\m, \\r, \\s, \\v  or references to the OS platform    OR    If the motd is not used, this file can be removed. Run the following command to remove the motd file: # rm /etc/motd"
    compliance:
      - cis: ["1.7.1"]
    condition: none
    rules:
      - 'f:/etc/motd -> r:\\v|\\r|\\m|\\s|Amazon'

    # 1.7.2 Ensure local login warning banner is configured properly.
  - id: 31051
    title: "Ensure local login warning banner is configured properly."
    description: "The contents of the /etc/issue file are displayed to users prior to login for local terminals. Unix-based systems have typically displayed information about the OS release and patch level upon logging in to the system. This information can be useful to developers who are developing software for a particular OS platform. If mingetty(8) supports the following options, they display operating system information: \\m - machine architecture \\r - operating system release \\s - operating system name \\v - operating system version -or the operating system's name."
    rationale: 'Warning messages inform users who are attempting to login to the system of their legal status regarding the system and must include the name of the organization that owns the system and any monitoring policies that are in place. Displaying OS and patch level information in login banners also has the side effect of providing detailed system information to attackers attempting to target specific exploits of a system. Authorized users can easily get this information by running the " uname -a " command once they have logged in.'
    remediation: "Edit the /etc/issue file with the appropriate contents according to your site policy, remove any instances of \\m, \\r, \\s, \\v, or references to teh OS platform: # echo \"Authorized uses only. All activity may be monitored and reported.\" > /etc/issue"
    compliance:
      - cis: ["1.7.2"]
    condition: none
    rules:
      - 'f:/etc/issue -> r:\\v|\\r|\\m|\\s|Amazon'

  # 1.7.3 "Ensure remote login warning banner is configured properly.
  - id: 31052
    title: "Ensure remote login warning banner is configured properly."
    description: "The contents of the /etc/issue.net file are displayed to users prior to login for remote connections from configured services. Unix-based systems have typically displayed information about the OS release and patch level upon logging in to the system. This information can be useful to developers who are developing software for a particular OS platform. If mingetty(8) supports the following options, they display operating system information: \\m - machine architecture \\r - operating system release \\s - operating system name \\v - operating system version."
    rationale: 'Warning messages inform users who are attempting to login to the system of their legal status regarding the system and must include the name of the organization that owns the system and any monitoring policies that are in place. Displaying OS and patch level information in login banners also has the side effect of providing detailed system information to attackers attempting to target specific exploits of a system. Authorized users can easily get this information by running the " uname -a " command once they have logged in.'
    remediation: "Edit the /etc/issue.net file with the appropriate contents according to your site policy, remove any instances of \\m, \\r, \\s, \\v, or references to teh OS platform: # echo \"Authorized uses only. All activity may be monitored and reported.\" > /etc/issue.net"
    compliance:
      - cis: ["1.7.3"]
    condition: none
    rules:
      - 'f:/etc/issue.net -> r:\\v|\\r|\\m|\\s|Amazon'

  # 1.7.4 Ensure permissions on /etc/motd are configured.
  - id: 31053
    title: "Ensure permissions on /etc/motd are configured."
    description: "The contents of the /etc/motd file are displayed to users after login and function as a message of the day for authenticated users."
    rationale: "If the /etc/motd file does not have the correct ownership it could be modified by unauthorized users with incorrect or misleading information."
    remediation: "Run the following commands to set permissions on /etc/motd: # chown root:root /etc/motd # chmod 644 /etc/motd"
    compliance:
      - cis: ["1.7.4"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
    condition: all
    rules:
      - 'c:stat -L /etc/motd -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  # 1.7.5 Ensure permissions on /etc/issue are configured.
  - id: 31054
    title: "Ensure permissions on /etc/issue are configured."
    description: "The contents of the /etc/issue file are displayed to users prior to login for local terminals."
    rationale: "If the /etc/issue file does not have the correct ownership it could be modified by unauthorized users with incorrect or misleading information."
    remediation: "Run the following commands to set permissions on /etc/issue: # chown root:root /etc/issue # chmod 644 /etc/issue"
    compliance:
      - cis: ["1.7.5"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
    condition: all
    rules:
      - 'c:stat -L /etc/issue -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  # 1.7.6 Ensure permissions on /etc/issue.net are configured.
  - id: 31055
    title: "Ensure permissions on /etc/issue.net are configured."
    description: "The contents of the /etc/issue.net file are displayed to users prior to login for remote connections from configured services."
    rationale: "If the /etc/issue.net file does not have the correct ownership it could be modified by unauthorized users with incorrect or misleading information."
    remediation: "Run the following commands to set permissions on /etc/issue.net: # chown root:root /etc/issue.net # chmod 644 /etc/issue.net"
    compliance:
      - cis: ["1.7.6"]
      - cis_csc_v8: ["3.3"]
      - cis_csc_v7: ["14.6"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.1",
            "AC.L1-3.1.2",
            "AC.L2-3.1.5",
            "AC.L2-3.1.3",
            "MP.L2-3.8.2",
          ]
      - hipaa: ["164.308(a)(3)(i)", "164.308(a)(3)(ii)(A)", "164.312(a)(1)"]
      - pci_dss_3.2.1: ["7.1", "7.1.1", "7.1.2", "7.1.3"]
      - pci_dss_4.0: ["1.3.1", "7.1"]
      - nist_sp_800-53: ["AC-3", "MP-2"]
    condition: all
    rules:
      - 'c:stat -L /etc/issue.net -> r:Access:\s*\(0644/-rw-r--r--\)\s*Uid:\s*\(\s*\t*0/\s*\t*root\)\s*\t*Gid:\s*\(\s*\t*0/\s*\t*root\)'

  ############################################################
  # 1.8  GNOME Display Manager.
  ############################################################

  # 1.8.1 Ensure GNOME Display Manager is removed
  - id: 31056
    title: "Ensure GNOME Display Manager is removed."
    description: "The GNOME Display Manager (GDM) is a program that manages graphical display servers and handles graphical user logins."
    rationale: "If a Graphical User Interface (GUI) is not required, it should be removed to reduce the attack surface of the system."
    impact: "Removing the GNOME Display manager will remove the Graphical User Interface (GUI) from the system."
    remediation: "Run the following command to remove the gdm package: # dnf remove gdm"
    compliance:
      - cis: ["1.8.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["2.6"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    references:
      - https://wiki.gnome.org/Projects/GDM
    condition: all
    rules:
      - "c:rpm -q gdm -> r:package gdm is not installed"

  # 1.8.2 Ensure GDM login banner is configured (Automated) - Not implemented
  # 1.8.3 Ensure user list display is disabled (Automated) - Not implemented

  # 1.8.4 Ensure XDCMP is not enabled (Automated)
  - id: 31057
    title: "Ensure XDCMP is not enabled."
    description: "X Display Manager Control Protocol (XDMCP) is designed to provide authenticated access to display management services for remote displays."
    rationale: "XDMCP is inherently insecure. XDMCP is not a ciphered protocol. This may allow an attacker to capture keystrokes entered by a user XDMCP is vulnerable to man-in-the-middle attacks. This may allow an attacker to steal the credentials of legitimate users by impersonating the XDMCP server."
    remediation: "Edit the file /etc/gdm/custom.conf and remove the line: Enable=true Default Value: false (This is denoted by no Enabled= entry in the file /etc/gdm/custom.conf in the [xdmcp] section."
    compliance:
      - cis: ["1.8.4"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["SC-8"]
    references:
      - https://help.gnome.org/admin/gdm/2.32/configuration.html.en
    condition: any
    rules:
      - "not f:/etc/gdm"
      - 'not f:/etc/gdm/custom.conf -> r:^\s*Enable\s*=\s*true'

  # 1.8.5 Ensure automatic mounting of removable media is disabled (Automated) - Not implemented

  # 1.9 Ensure updates, patches, and additional security software are installed (Manual) - Not implemented

  # 1.10 Ensure system-wide crypto policy is not legacy.
  - id: 31058
    title: "Ensure system-wide crypto policy is not legacy."
    description: "The system-wide crypto-policies followed by the crypto core components allow consistently deprecating and disabling algorithms system-wide. The individual policy levels (DEFAULT, LEGACY, FUTURE, and FIPS) are included in the crypto-policies(7) package."
    rationale: "If the Legacy system-wide crypto policy is selected, it includes support for TLS 1.0, TLS 1.1, and SSH2 protocols or later. The algorithms DSA, 3DES, and RC4 are allowed, while RSA and Diffie-Hellman parameters are accepted if larger than 1023-bits. These legacy protocols and algorithms can make the system vulnerable to attacks, including those listed in RFC 7457."
    impact: "Environments that require compatibility with older insecure protocols may require the use of the less secure LEGACY policy level."
    remediation: "Run the following command to change the system-wide crypto policy: # update-crypto-policies --set <CRYPTO POLICY>. Run the following command to make the updated system-wide crypto policy active: # update-crypto-policies. NOTE: To switch to FIPS mode, run the following command: # fips-mode-setup --enable."
    compliance:
      - cis: ["1.10"]
      - cis_csc_v8: ["3.10"]
      - cis_csc_v7: ["14.4"]
      - cmmc_v2.0: ["SC.3.177", "SC.3.185"]
      - iso_27001-2013: ["A.13.1.1", "A.10.1.1"]
      - mitre_techniques:
          [
            "T1527",
            "T1119",
            "T1530",
            "T1114",
            "T1070",
            "T1208",
            "T1040",
            "T1145",
            "T1492",
            "T1493",
          ]
      - pci_dss_v3.2.1: ["4.1"]
    references:
      - CRYPTO-POLICIES(7)
      - https://access.redhat.com/articles/3642912#what-polices-are-provided-1
    condition: any
    rules:
      - "not f:/etc/gdm"
      - 'not f:/etc/gdm/custom.conf -> r:^\s*Enable\s*=\s*true'

  ############################################################
  # 2 Services.
  ############################################################
  ############################################################
  # 2.1 Time Synchronization.
  ############################################################

  # 2.1.1 Ensure time synchronization is in use.
  - id: 31059
    title: "Ensure time synchronization is in use."
    description: "System time should be synchronized between all systems in an environment. This is typically done by establishing an authoritative time server or set of servers and having all systems synchronize their clocks to them."
    rationale: "Time synchronization is important to support time sensitive security mechanisms like Kerberos and also ensures log files have consistent time records across the enterprise, which aids in forensic investigations."
    remediation: "Run One of the following commands to install chrony: # dnf install chrony"
    compliance:
      - cis: ["2.1.1"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - nist_800-53: ["AU-3", "AU-12"]
      - tsc: ["CC6.1", "CC6.8", "CC7.2", "CC7.3", "CC7.4"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - pci_dss_3.2.1: ["10.4"]
      - pci_dss_4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: any
    rules:
      # - "not c:rpm -q ntp -> r:^package ntp is not installed"
      - "not c:rpm -q chrony -> r:^package chrony is not installed"

  # 2.1.2  Ensure chrony is configured.
  - id: 31060
    title: "Ensure chrony is configured."
    description: "chrony is a daemon which implements the Network Time Protocol (NTP) and is designed to synchronize system clocks across a variety of systems and use a source that is highly accurate. More information on chrony can be found at http://chrony.tuxfamily.org/. chrony can be configured to be a client and/or a server."
    rationale: "If chrony is in use on the system proper configuration is vital to ensuring time synchronization is working properly. Note: This recommendation only applies if chrony is in use on the system."
    remediation: '1) Add or edit server or pool lines to /etc/chrony.conf as appropriate: server <remote-server>. 2) Add or edit the OPTIONS in /etc/sysconfig/chronyd to include ''-u chrony'':OPTIONS=" -u chrony"'
    compliance:
      - cis: ["2.1.2"]
      - cis_csc_v8: ["8.4"]
      - cis_csc_v7: ["6.1"]
      - nist_800-53: ["AU-3", "AU-12"]
      - tsc: ["CC6.1", "CC6.8", "CC7.2", "CC7.3", "CC7.4"]
      - cmmc_v2.0: ["AU.L2-3.3.7"]
      - pci_dss_3.2.1: ["10.4"]
      - pci_dss_4.0: ["10.6", "10.6.1", "10.6.2", "10.6.3"]
      - soc_2: ["CC4.1", "CC5.2"]
    condition: all
    rules:
      - 'f:/etc/chrony.conf -> r:^server\.+$|^pool\.+$'
      - 'f:/etc/sysconfig/chronyd -> r:^OPTIONS\s*=\s* && r:-u chrony'

  # 2.2.1  Ensure xinetd is not installed.
  - id: 31061
    title: "Ensure xinetd is not installed."
    description: "The eXtended InterNET Daemon ( xinetd ) is an open source super daemon that replaced the original inetd daemon. The xinetd daemon listens for well known services and dispatches the appropriate daemon to properly respond to service requests."
    rationale: "If there are no xinetd services required, it is recommended that the package be removed to reduce the attack surface are of the system. Note: If an xinetd service or services are required, ensure that any xinetd service not required is stopped and disabled."
    remediation: "Run the following command to remove xinetd: # dnf remove xinetd"
    compliance:
      - cis: ["2.2.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["2.6", "9.2"]
      - nist_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q xinetd -> r:^package xinetd is not installed"

  # 2.2.2 Ensure xorg-x11-server-common is not installed
  - id: 31062
    title: "Ensure xorg-x11-server-common is not installed."
    description: "The X Window System provides a Graphical User Interface (GUI) where users can have multiple windows in which to run programs and various add on. The X Windows system is typically used on workstations where users login, but not on servers where users typically do not login."
    rationale: "Unless your organization specifically requires graphical login access via X Windows, remove it to reduce the potential attack surface."
    impact: "Many Linux systems run applications which require a Java runtime. Some Linux Java packages have a dependency on specific X Windows xorg-x11-fonts. One workaround to avoid this dependency is to use the 'headless' Java packages for your specific Java runtime."
    remediation: "Run the following command to remove the X Windows Server packages: # dnf remove xorg-x11-server-common"
    compliance:
      - cis: ["2.1.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:rpm -q xorg-x11-server-common -> r:package xorg-x11-server-common is not installed"

  # 2.2.3 Ensure Avahi Server is not installed.
  - id: 31063
    title: "Ensure Avahi Server is not installed."
    description: "Avahi is a free zeroconf implementation, including a system for multicast DNS/DNS-SD service discovery. Avahi allows programs to publish and discover services and hosts running on a local network with no specific configuration. For example, a user can plug a computer into a network and Avahi automatically finds printers to print to, files to look at and people to talk to, as well as network services running on the machine."
    rationale: "Automatic discovery of network services is not normally required for system functionality. It is recommended to disable this package to reduce the potential attack surface."
    remediation: "Run the following commands to stop, mask and remove avahi-autoipd and avahi: # systemctl stop avahi-daemon.socket avahi-daemon.service # dnf remove avahi-autoipd avahi"
    compliance:
      - cis: ["2.2.3"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q avahi-autoipd -> r:package avahi-autoipd is not installed"
      - "c:rpm -q avahi -> r:package avahi is not installed"

  # 2.2.4 Ensure CUPS is not installed.
  - id: 31064
    title: "Ensure CUPS is not installed."
    description: "The Common Unix Print System (CUPS) provides the ability to print to both local and network printers. A system running CUPS can also accept print jobs from remote systems and print them to local printers. It also provides a web based remote administration capability."
    rationale: "If the system does not need to print jobs or accept print jobs from other systems, it is recommended that CUPS be disabled to reduce the potential attack surface. Disabling CUPS will prevent printing from the system, a common task for workstation systems."
    impact: "Disabling CUPS will prevent printing from the system, a common task for workstation systems."
    remediation: "Run the following command to remove cups: # dnf remove cups"
    references:
      - More detailed documentation on CUPS is available at the project homepage at https://www.cups.org
    compliance:
      - cis: ["2.2.4"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q cups -> r:package cups is not installed"

  # 2.2.5 Ensure DHCP Server is not installed.
  - id: 31065
    title: "Ensure DHCP Server is not installed."
    description: "The Dynamic Host Configuration Protocol (DHCP) is a service that allows machines to be dynamically assigned IP addresses."
    rationale: "Unless a system is specifically set up to act as a DHCP server, it is recommended that the dhcp-server package be removed to reduce the potential attack surface."
    remediation: "Run the following command to remove dhcp: # dnf remove dhcp"
    compliance:
      - cis: ["2.2.5"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    references:
      - dhcpd(8)
    condition: all
    rules:
      - "c:rpm -q dhcp -> r:package dhcp is not installed"

  # 2.2.6 Ensure DNS Server is not installed.
  - id: 31066
    title: "Ensure DNS Server is not installed."
    description: "The Domain Name System (DNS) is a hierarchical naming system that maps names to IP addresses for computers, services and other resources connected to a network."
    rationale: "Unless a system is specifically designated to act as a DNS server, it is recommended that the package be removed to reduce the potential attack surface."
    remediation: "Run the following command to remove bind: # dnf remove bind"
    compliance:
      - cis: ["2.2.6"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q bind -> r:package bind is not installed"

  # 2.2.7 Ensure FTP client is not installed.
  - id: 31067
    title: "Ensure FTP client is not installed."
    description: "FTP (File Transfer Protocol) is a traditional and widely used standard tool for transferring files between a server and clients over a network, especially where no authentication is necessary (permits anonymous users to connect to a server)."
    rationale: "FTP does not protect the confidentiality of data or authentication credentials. It is recommended SFTP be used if file transfer is required. Unless there is a need to run the system as a FTP server (for example, to allow anonymous downloads), it is recommended that the package be removed to reduce the potential attack surface."
    remediation: "Run the following command to remove ftp: # dnf remove ftp"
    compliance:
      - cis: ["2.2.7"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q ftp -> r:package ftp is not installed"

  # 2.2.8 Ensure FTP Server is not installed.
  - id: 31068
    title: "Ensure FTP Server is not installed."
    description: "FTP (File Transfer Protocol) is a traditional and widely used standard tool for transferring files between a server and clients over a network, especially where no authentication is necessary (permits anonymous users to connect to a server)."
    rationale: "Unless there is a need to run the system as a FTP server, it is recommended that the package be removed to reduce the potential attack surface."
    remediation: "Run the following command to remove vsftpd: # dnf remove vsftpd"
    compliance:
      - cis: ["2.2.8"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q vsftpd -> r:package vsftpd is not installed"

  # 2.2.9 Ensure TFTP Server is not installed.
  - id: 31069
    title: "Ensure TFTP Server is not installed."
    description: "Trivial File Transfer Protocol (TFTP) is a simple protocol for exchanging files between two TCP/IP machines. TFTP servers allow connections from a TFTP Client for sending and receiving files."
    rationale: "TFTP does not have built-in encryption, access control or authentication. This makes it very easy for an attacker to exploit TFTP to gain access to files."
    remediation: "Run the following command to remove tftp-server: # dnf remove tftp-server"
    compliance:
      - cis: ["2.2.9"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q tftp-server -> r:package tftp-server is not installed"

  # 2.2.10 Ensure a web server is not installed.
  - id: 31070
    title: "Ensure a web server is not installed."
    description: "Web servers provide the ability to host web site content."
    rationale: "Unless there is a need to run the system as a web server, it is recommended that the packages be removed to reduce the potential attack surface. Note: Several http servers exist. They should also be audited, and removed, if not required."
    remediation: "Run the following command to remove httpd and nginx: # dnf remove httpd nginx"
    compliance:
      - cis: ["2.2.10"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q httpd -> r:package httpd is not installed"
      - "c:rpm -q nginx -> r:package nginx is not installed"

  # 2.2.11 Ensure IMAP and POP3 server is not installed.
  - id: 31071
    title: "Ensure IMAP and POP3 server is not installed."
    description: "dovecot is an open source IMAP and POP3 server for Linux based systems."
    rationale: "Unless POP3 and/or IMAP servers are to be provided by this system, it is recommended that the package be removed to reduce the potential attack surface."
    remediation: "Run the following command to remove dovecot and cyrus-imapd: # dnf remove dovecot cyrus-imapd"
    compliance:
      - cis: ["2.2.11"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q dovecot -> r:package dovecot is not installed"
      - "c:rpm -q cyrus-imapd -> r:package cyrus-imapd is not installed"

  # 2.2.12 Ensure Samba is not installed.
  - id: 31072
    title: "Ensure Samba is not installed."
    description: "The Samba daemon allows system administrators to configure their Linux systems to share file systems and directories with Windows desktops. Samba will advertise the file systems and directories via the Small Message Block (SMB) protocol. Windows desktop users will be able to mount these directories and file systems as letter drives on their systems."
    rationale: "If there is no need to mount directories and file systems to Windows systems, then this package can be removed to reduce the potential attack surface."
    remediation: "Run the following command to remove samba: # dnf remove samba"
    compliance:
      - cis: ["2.2.12"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q samba -> r:package samba is not installed"

  # 2.2.13 Ensure HTTP Proxy Server is not installed.
  - id: 31073
    title: "Ensure HTTP Proxy Server is not installed."
    description: "Squid is a standard proxy server used in many distributions and environments."
    rationale: "If there is no need for a proxy server, it is recommended that the squid package be removed to reduce the potential attack surface."
    remediation: "Run the following command to remove squid: # dnf remove squid"
    compliance:
      - cis: ["2.2.13"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q squid -> r:package squid is not installed"

  # 2.2.14 Ensure net-snmp is not installed.
  - id: 31074
    title: "Ensure SNMP Server is not installed."
    description: "The Simple Network Management Protocol (SNMP) server is used to listen for SNMP commands from an SNMP management system, execute the commands or collect the information and then send results back to the requesting system."
    rationale: "The SNMP server can communicate using SNMPv1, which transmits data in the clear and does not require authentication to execute commands. SNMPv3replaces the simple/clear text password sharing used in SNMPv2with more securely encoded parameters. If the SNMP service is not required, the net-snmp package should be removed to reduce the attack surface of the system."
    remediation: "Run the following command to remove net-snmp: # dnf remove net-snmp"
    compliance:
      - cis: ["2.2.14"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2", "2.6"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q net-snmp -> r:package net-snmp is not installed"

  # 2.2.15 Ensure NIS server is not installed.
  - id: 31075
    title: "Ensure NIS server is not installed."
    description: "The ypserv package provides the Network Information Service (NIS). This service, formally known as Yellow Pages, is a client-server directory service protocol for distributing system configuration files. The NIS server is a collection of programs that allow for the distribution of configuration files."
    rationale: "The NIS service is inherently an insecure system that has been vulnerable to DOS attacks, buffer overflows and has poor authentication for querying NIS maps. NIS generally has been replaced by such protocols as Lightweight Directory Access Protocol (LDAP). It is recommended that the ypserv package be removed, and if required a more secure services be used."
    remediation: "Run the following command to remove ypserv: # dnf remove ypserv"
    compliance:
      - cis: ["2.2.15"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2", "2.6"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q ypserv -> r:package ypserv is not installed"

  # 2.2.16 Ensure telnet-server is not installed.
  - id: 31076
    title: "Ensure NIS server is not installed."
    description: "The telnet-server package contains the telnet daemon, which accepts connections from users from other systems via the telnet protocol."
    rationale: "The telnet protocol is insecure and unencrypted. The use of an unencrypted transmission medium could allow a user with access to sniff network traffic the ability to steal credentials. The ssh package provides an encrypted session and stronger security."
    remediation: "Run the following command to remove telnet-server: # dnf remove telnet-server"
    compliance:
      - cis: ["2.2.16"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2", "2.6"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q telnet-server -> r:package telnet-server is not installed"

  # 2.2.17 Ensure mail transfer agent is configured for local-only mode.
  - id: 31077
    title: "Ensure mail transfer agent is configured for local-only mode."
    description: "Mail Transfer Agents (MTA), such as sendmail and Postfix, are used to listen for incoming mail and transfer the messages to the appropriate user or mail server. If the system is not intended to be a mail server, it is recommended that the MTA be configured to only process local mail."
    rationale: "The software for all Mail Transfer Agents is complex and most have a long history of security issues. While it is important to ensure that the system can process local mail messages, it is not necessary to have the MTA's daemon listening on a port unless the server is intended to be a mail server that receives and processes mail from other systems."
    remediation: "Edit /etc/postfix/main.cf and add the following line to the RECEIVING MAIL section. If the line already exists, change it to look like the line below: inet_interfaces = loopback-only . Restart postfix: # systemctl restart postfix"
    compliance:
      - cis: ["2.2.17"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: none
    rules:
      - 'c:ss -lntu -> r:\.*:25\s* && !r:127.0.0.1:25\.*|::1:25\.*'

  # 2.2.18 Ensure nfs-utils is not installed or the nfs-server service is masked.
  - id: 31078
    title: "Ensure nfs-utils is not installed or the nfs-server service is masked."
    description: "The Network File System (NFS) is one of the first and most widely distributed file systems in the UNIX environment. It provides the ability for systems to mount file systems of other servers through the network."
    rationale: "If the system does not export NFS shares or act as an NFS client, it is recommended that these services be disabled to reduce remote attack surface of the system."
    impact: "Many of the libvirt packages used by Enterprise Linux virtualization are dependent on the nfs-utils package. If the nfs-package is required as a dependency, the nfs-server should be disabled and masked to reduce the attack surface of the system."
    remediation: "Run the following command to remove nfs-utils: # dnf remove nfs-utils OR If the nfs-package is required as a dependency, run the following command to stop and mask the nfs-server service: # systemctl --now mask nfs-server"
    compliance:
      - cis: ["2.2.18"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:rpm -q nfs-utils -> r:package nfs-utils is not installed"
      - "c:systemctl is-enabled nfs-server -> r:masked"

  # 2.2.19 Ensure rpcbind is not installed or the rpcbind services are masked.
  - id: 31079
    title: "Ensure rpcbind is not installed or the rpcbind services are masked."
    description: "The rpcbind utility maps RPC services to the ports on which they listen. RPC processes notify rpcbind when they start, registering the ports they are listening on and the RPC program numbers they expect to serve. The client system then contacts rpcbind on the server with a particular RPC program number. The rpcbind service redirects the client to the proper port number so it can communicate with the requested service Portmapper is an RPC service, which always listens on tcp and udp 111, and is used to map other RPC services (such as nfs, nlockmgr, quotad, mountd, etc.) to their corresponding port number on the server. When a remote host makes an RPC call to that server, it first consults with portmap to determine where the RPC server is listening."
    rationale: "A small request (~82 bytes via UDP) sent to the Portmapper generates a large response (7x to 28x amplification), which makes it a suitable tool for DDoS attacks. If rpcbind is not required, it is recommended that the rpcbind package be removed to reduce the attack surface of the system."
    impact: "Many of the libvirt packages used by Enterprise Linux virtualization, and the nfs-utils package used for The Network File System (NFS), are dependent on the rpcbind package. If the rpcbind package is required as a dependency, the services rpcbind.service and rpcbind.socket should be stopped and masked to reduce the attack surface of the system."
    remediation: "Run the following command to remove rpcbind: # dnf remove rpcbind OR If the rpcbind is required as a dependency, run the following command to stop and mask the rpcbind and rpcbind.socket services: # systemctl --now mask nfs-server && # systemctl --now mask rpcbind.socket"
    compliance:
      - cis: ["2.2.19"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:rpm -q rpcbind -> r:package rpcbind is not installed"
      - "c:systemctl is-enabled rpcbind -> r:masked"
      - "c:systemctl is-enabled rpcbind.socket -> r:masked"

  # 2.2.20 Ensure rsync is not installed or the rsyncd service is masked.
  - id: 31080
    title: "Ensure rsync is not installed or the rsyncd service is masked."
    description: "The rsyncd service can be used to synchronize files between systems over network links."
    rationale: "Unless required, the rsync package should be removed to reduce the attack surface area of the system. The rsyncd service presents a security risk as it uses unencrypted protocols for communication."
    impact: "There are packages that are dependent on the rsync package. If the rsync package is removed, these packages will be removed as well. Before removing the rsync package, review any dependent packages to determine if they are required on the system. If a dependent package is required, mask the rsyncd service and leave the rsync package installed."
    remediation: "Run the following command to remove the rsync package: # dnf remove rsync    OR    Run the following command to mask the rsyncd service: # systemctl --now mask rsyncd"
    compliance:
      - cis: ["2.2.20"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:rpm -q rsync -> r:package rsync is not installed"
      - "c:systemctl is-enabled rsyncd -> r:masked"

  ############################################################
  # 2.3 Service Clients.
  ############################################################

  # 2.3.1 Ensure NIS Client is not enabled.
  - id: 31081
    title: "Ensure NIS Client is not installed."
    description: "The Network Information Service (NIS), formerly known as Yellow Pages, is a client-server directory service protocol used to distribute system configuration files. The NIS client ( ypbind ) was used to bind a machine to an NIS server and receive the distributed configuration files."
    rationale: "The NIS service is inherently an insecure system that has been vulnerable to DOS attacks, buffer overflows and has poor authentication for querying NIS maps. NIS generally has been replaced by such protocols as Lightweight Directory Access Protocol (LDAP). It is recommended that the service be removed."
    impact: "Many insecure service clients are used as troubleshooting tools and in testing environments. Uninstalling them can inhibit capability to test and troubleshoot. If they are required it is advisable to remove the clients after use to prevent accidental or intentional misuse."
    remediation: "Run the following command to uninstall ypbind: # dnf remove ypbind"
    compliance:
      - cis: ["2.3.1"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["2.6"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
      - nist_sp_800-53: ["CM-7"]
    condition: all
    rules:
      - "c:rpm -q ypbind -> r:package ypbind is not installed"

  # 2.3.2 Ensure rsh client is not installed.
  - id: 31082
    title: "Ensure rsh client is not installed."
    description: "The rsh package contains the client commands for the rsh services."
    rationale: "These legacy clients contain numerous security exposures and have been replaced with the more secure SSH package. Even if the server is removed, it is best to ensure the clients are also removed to prevent users from inadvertently attempting to use these commands and therefore exposing their credentials. Note that removing the rsh package removes the clients for rsh, rcp and rlogin ."
    impact: "Many insecure service clients are used as troubleshooting tools and in testing environments. Uninstalling them can inhibit capability to test and troubleshoot. If they are required it is advisable to remove the clients after use to prevent accidental or intentional misuse."
    remediation: "Run the following command to uninstall rsh: # dnf remove rsh"
    compliance:
      - cis: ["2.3.2"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["2.6"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
      - nist_sp_800-53: ["CM-7"]
    condition: all
    rules:
      - "c:rpm -q rsh -> r:^package rsh is not installed"

  # 2.3.3 Ensure talk client is not installed.
  - id: 31083
    title: "Ensure talk client is not installed."
    description: "The talk software makes it possible for users to send and receive messages across systems through a terminal session. The talk client, which allows initialization of talk sessions, is installed by default."
    rationale: "The software presents a security risk as it uses unencrypted protocols for communication."
    impact: "Many insecure service clients are used as troubleshooting tools and in testing environments. Uninstalling them can inhibit capability to test and troubleshoot. If they are required it is advisable to remove the clients after use to prevent accidental or intentional misuse."
    remediation: "Run the following command to uninstall talk: # dnf remove talk"
    compliance:
      - cis: ["2.3.3"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["2.6"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
      - nist_sp_800-53: ["CM-7"]
    condition: all
    rules:
      - "c:rpm -q talk -> r:^package talk is not installed"

  # 2.3.4 Ensure telnet client is not installed.
  - id: 31084
    title: "Ensure telnet client is not installed."
    description: "The telnet package contains the telnet client, which allows users to start connections to other systems via the telnet protocol."
    rationale: "The telnet protocol is insecure and unencrypted. The use of an unencrypted transmission medium could allow an unauthorized user to steal credentials. The ssh package provides an encrypted session and stronger security and is included in most Linux distributions."
    impact: "Many insecure service clients are used as troubleshooting tools and in testing environments. Uninstalling them can inhibit capability to test and troubleshoot. If they are required it is advisable to remove the clients after use to prevent accidental or intentional misuse."
    remediation: "Run the following command to uninstall telnet: # dnf remove telnet"
    compliance:
      - cis: ["2.3.4"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["2.6"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
      - nist_sp_800-53: ["CM-7"]
    condition: all
    rules:
      - "c:rpm -q telnet -> r:^package telnet is not installed"

  # 2.3.5 Ensure LDAP client is not installed.
  - id: 31085
    title: "Ensure LDAP client is not installed."
    description: "The Lightweight Directory Access Protocol (LDAP) was introduced as a replacement for NIS/YP. It is a service that provides a method for looking up information from a central database."
    rationale: "If the system will not need to act as an LDAP client, it is recommended that the software be removed to reduce the potential attack surface."
    impact: "Removing the LDAP client will prevent or inhibit using LDAP for authentication in your environment."
    remediation: "Run the following command to uninstall openldap-clients: # dnf remove openldap-clients"
    compliance:
      - cis: ["2.3.5"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["2.6"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
      - nist_sp_800-53: ["CM-7"]
    condition: all
    rules:
      - "c:rpm -q openldap-clients -> r:^package openldap-clients is not installed"

  # 2.3.6 Ensure TTFTP client is not installed.
  - id: 31086
    title: "Ensure TTFTP client is not installed.."
    description: "Trivial File Transfer Protocol (TFTP) is a simple protocol for exchanging files between two TCP/IP machines. TFTP servers allow connections from a TFTP Client for sending and receiving files."
    rationale: "TFTP does not have built-in encryption, access control or authentication. This makes it very easy for an attacker to exploit TFTP to gain access to files."
    remediation: "Run the following command to remove tftp: # dnf remove tftp"
    compliance:
      - cis: ["2.3.6"]
      - cis_csc_v8: ["4.8"]
      - cis_csc_v7: ["9.2"]
      - nist_sp_800-53: ["CM-7"]
      - cmmc_v2.0: ["CM.L2-3.4.7", "CM.L2-3.4.8", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5"]
      - pci_dss_4.0: ["1.2.5", "2.2.4", "6.4.1"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q tftp -> r:package tftp is not installed"

  # 2.4 Ensure nonessential services are removed or masked (Manual) - Not implemented

  ############################################################
  # 3 Network Configuration
  ############################################################

  #######################################################
  # 3.1 Disable unused network protocols and devices.
  #######################################################

  # 3.1.1 Review if IPv6 is in use on the system (Manual) - Not implemented
  # 3.1.2 Ensure wireless interfaces are disabled (Automated) - Not implemented

  #######################################################
  # 3.2 Network Parameters (Host Only).
  # TODO copy from cis_amazon_linux_1 (?)
  #######################################################
  # 3.2.1 Ensure IP forwarding is disabled (Automated) - Not implemented
  # 3.2.2 Ensure packet redirect sending is disabled (Automated) - Not implemented

  ##################################################
  # 3.3 Network Parameters (Host and Router).
  # TODO copy from cis_amazon_linux_1 (?)
  ##################################################
  # 3.3.1 Ensure source routed packets are not accepted (Automated) - Not implemented
  # 3.3.2 Ensure ICMP redirects are not accepted (Automated) - Not implemented
  # 3.3.3 Ensure secure ICMP redirects are not accepted (Automated) - Not implemented
  # 3.3.4 Ensure suspicious packets are logged (Automated) - Not implemented
  # 3.3.5 Ensure broadcast ICMP requests are ignored (Automated) - Not implemented
  # 3.3.6 Ensure bogus ICMP responses are ignored (Automated) - Not implemented
  # 3.3.7 Ensure Reverse Path Filtering is enabled (Automated) - Not implemented
  # 3.3.8 Ensure TCP SYN Cookies is enabled (Automated) - Not implemented
  # 3.3.9 Ensure IPv6 router advertisements are not accepted (Automated) - Not implemented

  ############################################################
  # 3.4 Firewall Configuration.
  ############################################################

  ############################################################
  # 3.4.1 Configure firewalld.
  ############################################################

  # 3.4.1.1 Ensure firewalld is installed.
  - id: 31087
    title: "Ensure firewalld is installed."
    description: "firewalld is a firewall management tool for Linux operating systems. It provides firewall features by acting as a front-end for the Linux kernel's netfilter framework via the iptables backend or provides firewall features by acting as a front-end for the Linux kernel's netfilter framework via the nftables utility. firewalld replaces iptables as the default firewall management tool. Use the firewalld utility to configure a firewall for less complex firewalls. The utility is easy to use and covers the typical use cases scenario. FirewallD supports both IPv4 and IPv6 networks and can administer separate firewall zones with varying degrees of trust as defined in zone profiles."
    rationale: "A firewall utility is required to configure the Linux kernel's netfilter framework via the iptables or nftables back-end. The Linux kernel's netfilter framework host-based firewall can protect against threats originating from within a corporate network to include malicious mobile code and poorly configured software on a host."
    impact: "Changing firewall settings while connected over the network can result in being locked out of the system."
    remediation: "Run the following command to install FirewallD and iptables: # dnf install firewalld iptables"
    compliance:
      - cis: ["3.4.1.1"]
      - cis_csc_v8: ["4.4"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0:
          ["AC.L1-3.1.20", "CM.L2-3.4.7", "SC.L1-3.13.1", "SC.L2-3.13.6"]
      - pci_dss_3.2.1: ["1.1.4", "1.3.1"]
      - pci_dss_4.0: ["1.2.1", "1.4.1"]
      - nist_sp_800-53: ["CA-9"]
      - soc_2: ["CC6.6"]
    condition: all
    rules:
      - "c:rpm -q firewalld -> r:firewalld-"
      - "c:rpm -q iptables -> r:iptables-"

  # 3.4.1.2 Ensure iptables-services not installed with firewalld.
  # 3.4.2.3 Ensure iptables-services not installed with nftables.
  - id: 31088
    title: "Ensure iptables-services not installed with firewalld or nftables."
    description: "The iptables-services package contains the iptables.service and ip6tables.service. These services allow for management of the Host Based Firewall provided by the iptables package."
    rationale: "iptables.service and ip6tables.service are still supported and can be installed with the iptables-services package. Running both firewalld and the services included in the iptables-services package may lead to conflict."
    impact: "Running both firewalld and iptables/ip6tables service may lead to conflict."
    remediation: "Run the following commands to stop the services included in the iptables-services package and remove the iptables-services package # systemctl stop iptables # systemctl stop ip6tables # dnf remove iptables-services"
    compliance:
      - cis: ["3.4.1.2", "3.4.2.3"]
      - cis_csc_v8: ["4.4", "4.8"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.20",
            "CM.L2-3.4.7",
            "CM.L2-3.4.8",
            "SC.L1-3.13.1",
            "SC.L2-3.13.6",
          ]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5", "1.1.4", "1.3.1"]
      - pci_dss_4.0: ["1.2.1", "1.4.1", "1.2.5", "2.2.4", "6.4.1"]
      - nist_sp_800-53: ["CA-9", "CM-7"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: all
    rules:
      - "c:rpm -q iptables-services -> r:package iptables-services is not installed"
      # - "not c:rpm -q firewalld -> r:firewalld-"
      # - "not c:rpm -q nftables -> r:nftables-"

  # 3.4.1.3 Ensure nftables either not installed or masked with firewalld.
  - id: 31089
    title: "Ensure nftables either not installed or masked with firewalld."
    description: "nftables is a subsystem of the Linux kernel providing filtering and classification of network packets/datagrams/frames and is the successor to iptables."
    rationale: "Running both firewalld and nftables may lead to conflict."
    remediation: "Run the following command to remove nftables: # dnf remove nftables OR Run the following command to stop and mask nftables: # systemctl --now mask nftables"
    compliance:
      - cis: ["3.4.1.3"]
      - cis_csc_v8: ["4.4", "4.8"]
      - cis_csc_v7: ["9.4"]
      - cmmc_v2.0:
          [
            "AC.L1-3.1.20",
            "CM.L2-3.4.7",
            "CM.L2-3.4.8",
            "SC.L1-3.13.1",
            "SC.L2-3.13.6",
          ]
      - pci_dss_3.2.1: ["1.1.6", "1.2.1", "2.2.2", "2.2.5", "1.1.4", "1.3.1"]
      - pci_dss_4.0: ["1.2.1", "1.4.1", "1.2.5", "2.2.4", "6.4.1"]
      - nist_sp_800-53: ["CA-9", "CM-7"]
      - soc_2: ["CC6.3", "CC6.6"]
    condition: any
    rules:
      - "c:rpm -q nftables -> r:^package nftables is not installed"
      - "c:ystemctl is-enabled nftables -> r:masked"
      - "c:systemctl is-active nftables -> r:inactive"
